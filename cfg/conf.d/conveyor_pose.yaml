%YAML 1.2
%TAG ! tag:fawkesrobotics.org,cfg/
---
doc-url: !url http://trac.fawkesrobotics.org/wiki/Plugins/webview
---
conveyor_pose:
  # sets the debug mode within the plugin, which eases the debugging,
  # which results in the following:
  # - the switch if is ignored, the plugin i running always
  debug: false
  # the point cloud that is used to detect the belt
  cloud_in: "/camera/depth/points"

  # Write trimmed point cloud into model_file (see options below for file name and
  # trimming parameters)
  # This completely changes the mode of operation to just record pointclouds,
  # no recognition is done when this is enabled.
  # If the target file already exists, an increasing integer is appended until
  # a file is found that doesn't exist, yet.
  record_model: true

  # Path to the PCD file containing the conveyor model.
  # Relative paths (i.e. not starting with "/") are looked up in CONFDIR (e.g. fawkes-robotino/cfg)
  model_file: "conveyor_model.pcd"

  if:
    # the prefix used for all interfaces
    prefix: conveyor_pose

    # the output point clouds
    cloud_out_intermediate: inter
    cloud_out_result: result
  
    # the position 3d interface of the result
    name: pose
    # should the pose interface be closed if no new pointcloud is availabe.
    # This would result that the if would have no writer after starup and at some ocasions during runtime.
    pose_close_if_new_pc: false
    # the switch interface
    switch: switch
    # the dynamic config interface
    config: config
    # the laser lines, they don't use the prefix
    laser_lines: [
      "/laser-lines/1",
      "/laser-lines/2",
      "/laser-lines/3",
      "/laser-lines/4",
      "/laser-lines/5",
      "/laser-lines/6",
      "/laser-lines/7",
      "/laser-lines/8"
    ]
  
  conveyor_frame_id: conveyor_pose
  switch_default: false
  use_visualisation: false

  # Config for the PCL correspondence grouping algorithm
  # All settings are optional and use the defaults below
  cg:
    #model_sampling_radius: 0.01
    #scene_sampling_radius: 0.03
    #reference_frame_radius: 0.015
    #descriptor_radius: 0.02
    #cluster_size: 0.01
    #clustering_threshold: 5

    # Discard model/scene descriptor pairs that exceed this distance.
    # Normalized value, so it ranges from 0 to 1. Default: 0.25
    #max_descriptor_distance: 0.25

    # Use pcl::Hough3DGrouping instead of pcl::GeometricConsistencyGrouping
    #use_hough: false


  # the maximum allowed distance that the vis_hist is not resetet
  vis_hist:
    # distance in x, y, z
    diff_pose: 0.1
    # distance in angle in rad
    diff_angle: 0.2
    average:
      # number of used elements for avg calculation
      size: 10
      # the minimum of poses used for a successfull used average
      used_min: 3
    allow_invalid_poses: 3

  # the dimensions of the gripper in the point cloud (check rotation of actual tf)
  gripper:
    y_min: -0.055
    y_max: -0.015
    z_max: 0.135
    slice:
      y_min: -0.025
      y_max: 0.03
  front:
    # the distance that is not pruned at the front of the MPS
    space: 0.6
    # this should be a tf, but I did not get it work :(
    offset: 0.005
  bottom:
    offset: 0.06
  left_right:
    left_cut: 0.1
    right_cut: 0.1
    left_cut_no_ll: 0.1
    right_cut_no_ll: 0.1
  cluster:
    tolerance: 0.0015
    size_min: 100
    size_max: 25000
  voxel_grid:
    leaf_size: 0.001

