%YAML 1.2
%TAG ! tag:fawkesrobotics.org,cfg/
---
doc-url: !url http://trac.fawkesrobotics.org/wiki/Plugins/webview
---
plugins/conveyor_pose:
  # sets the debug mode within the plugin, which eases the debugging,
  # which results in the following:
  # - the switch if is ignored, the plugin i running always
  debug: false
  # the point cloud that is used to detect the belt
  cloud_in: "/camera/depth/points"

  # Write trimmed point cloud into model_file (see options below for file name and
  # trimming parameters)
  # This completely changes the mode of operation to just record pointclouds,
  # no recognition is done when this is enabled.
  # If the target file already exists, an increasing integer is appended until
  # a file is found that doesn't exist, yet.
  record_model: false

  # If recording is enabled, a PCD file is written to CONFDIR "/" record path
  # (e.g.: conveyor_model_.pcd)
  record_path: "conveyor_model.pcd"

  # When recording a model (see above), transform the recorded model into this frame before
  # saving it. The robot should be positioned so that this frame is at the desired origin of
  # the conveyor (align the conveyor cloud & the TF in rviz)
  model_origin_frame: "gripper_fingers"

  # Path to the PCD file containing the conveyor model.
  # Relative paths (i.e. not starting with "/") are looked up in CONFDIR (e.g. fawkes-robotino/cfg)
  model_file: "conveyor_model.pcd"

  # Configurable PCD paths for every station containing the conveyor model
  # If the value is "default", the model_file PCD is taken
  model_files:
    M-BS-I: "default"
    M-BS-O: "default"
    C-BS-I: "default"
    C-BS-O: "default"
    M-CS1-I: "default"
    M-CS1-O: "default"
    C-CS1-I: "default"
    C-CS1-O: "default"
    M-CS2-I: "default"
    M-CS2-O: "default"
    C-CS2-I: "default"
    C-CS2-O: "default"
    M-RS1-I: "default"
    M-RS1-O: "default"
    C-RS1-I: "default"
    C-RS1-O: "default"
    M-RS2-I: "default"
    M-RS2-O: "default"
    C-RS2-I: "default"
    C-RS2-O: "default"
    M-DS-I: "default"
    C-DS-I: "default"

  icp:
    hint:
      conveyor:
        x: -0.01
        y: -0.02
        z: 0.6
      left_shelf:
        x: -0.01
        y: -0.22
        z: 0.6
      middle_shelf:
        x: -0.01
        y: -0.27
        z: 0.6
      right_shelf:
        x: -0.01
        y: -0.32
        z: 0.6
      slide:
        x: -0.01
        y: -0.32
        z: 0.6
    max_correspondence_dist: 0.01

    # Prefer last ICP result over laser line for initial guess if fitness is above this threshold
    track_odom_min_fitness: 8

  if:
    # the prefix used for all interfaces
    prefix: conveyor_pose

    # the switch interface
    switch: switch
    # the laser lines, they don't use the prefix
    laser_lines: [
      "/laser-lines/1",
      "/laser-lines/2",
      "/laser-lines/3",
      "/laser-lines/4",
      "/laser-lines/5",
      "/laser-lines/6",
      "/laser-lines/7",
      "/laser-lines/8"
    ]

  conveyor_frame_id: conveyor_pose
  switch_default: false

  # the dimensions of the gripper in the point cloud (check rotation of actual tf)
  gripper:
    y_min: -0.055
    y_max: -0.015
    z_max: 0.135
    slice:
      y_min: -0.04
      y_max: 0.03
  front:
    # the distance that is not pruned at the front of the MPS
    space: 0.6
    # this should be a tf, but I did not get it work :(
    offset: 0.005
  left_right:
    left_cut: 0.1
    right_cut: 0.1
    left_cut_no_ll: 0.1
    right_cut_no_ll: 0.1
  voxel_grid:
    leaf_size: 0.001

