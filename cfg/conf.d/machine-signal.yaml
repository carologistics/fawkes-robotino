%YAML 1.2
%TAG ! tag:fawkesrobotics.org,cfg/
---
doc-url: !url http://trac.fawkesrobotics.org/wiki/Plugins/machine_signal
---

plugins/machine_signal:
  #camera: file:file:file=/home/ich/robotino/sampleImages/color.raw
  camera: v4l2:signal:device=/dev/video_signal:size=640x480:awb=0:contrast=33:saturation=30:gain=80:white_balance_temperature=4000:exposure_auto_priority=0:exposure_auto=1:exposure_absolute=500:sharpness=0
  
  #
  # Start running when the plugin is loaded.
  # If set to false, signal detection needs to be activated via the light_switch
  #
  start_enabled: false

  #
  # Whether to start in delivery mode.
  # This is overridden by the switch interface machine_signal_delivery_mode
  #
  delivery_mode: false

  fps: 30

  ###########################################################
  #    All settings below can be changed at runtime         #
  ###########################################################

  # Enable the tuning buffer. Use fvviever -s machine_signal to view.
  #
  #    ------=====:::  ATTENTION  :::=====-----
  # Turn this off during matches to double performance!
  #
  tuning_mode: true

  # Draw ROIs as they are after being filtered, tarred and feathered
  # Disable this to see the raw ROIs as they come out of the classifier
  # (Useful for tuning the colormodels).
  # Ignored if tuning_mode == false.
  draw_processed_rois: true
 
  # Maximum width ratio between red and green ROIs. A red and a green
  # ROI that exceed this are not considered as part of a signal.
  roi_max_r2g_width_ratio: 1.3

  roi_xalign_by_width: 0.5

  # ROIs that exceed this aspect ratio are ignored.
  roi_max_aspect_ratio: 1.5

  # Green ROIs that start above this line are ignored
  roi_green_horizon: 100

  # ROIs higher/wider than this will have their height truncated and will be
  # re-classified. Currently used only when NOT in delivery
  # mode. Fixes disturbances from same-colored environment objects.
  roi_max_height: 108
  roi_max_width: 108

  # Maximum distance in pixels a signal is allowed to jump between frames
  # Increase this if you want to try and detect signals while moving.
  max_jitter: 60.0

  # Print frame state buffers to debug blinking detection
  # Careful: VERY verbose, i.e. 4 lines per frame.
  debug_blink: false

  debug_processing: false
  debug_tf: false

  laser_frame: !frame base_laser
  signal_width: 0.04
  signal_bottom: 0.12
  signal_top: 0.29
  cam_aperture_x: 1
  cam_aperture_y: 0.8
  cam_angle: 0
  #cam_angle: 0.25 # 12.2Â°
  cam_frame: !frame cam_signal

  red_on:
    visualize: false
    reference_color:   [0xff, 0, 0x0,
                        0xe0, 0, 0x40,
                        0xff, 0x7c, 0xb0,
                        0xff, 0xa0, 0xb0,
                        0xff, 0xe0, 0xe0,
                        0xff, 0xf0, 0xf0]
    chroma_thresh:     [40, 30, 20, 15, 10, 10]
    saturation_thresh: [30, 40, 35, 20, 10, 10]
    luma_thresh:       [240, 200, 200, 240, 200, 200]
    min_points: 28
    basic_roi_size: 10
    neighborhood_min_match: 8
    scangrid_x_offset: 2
    scangrid_y_offset: 2

  red_off:
    visualize: true
    reference_color:   [0x30, 0x0, 0,
                        0x20, 0x2, 0x2,
                        0x30, 0x14, 0x19]
    chroma_thresh:     [20, 8, 30]
    saturation_thresh: [20, 10, 15]
    luma_thresh:       [220, 180, 220]
    min_points: 40
    basic_roi_size: 10
    neighborhood_min_match: 6
    scangrid_x_offset: 2
    scangrid_y_offset: 2

  green_on:
    visualize: true
    reference_color:   [0x00, 0xff, 0x0,
                        0x0,  0x70, 0x25,
                        0x08, 0xf0, 0x30,
                        0x83, 0xff, 0xc2]
    chroma_thresh:     [20, 15, 15, 15]
    saturation_thresh: [20, 15, 15, 10]
    luma_thresh:       [250, 250, 200, 200]
    min_points: 40
    basic_roi_size: 10
    neighborhood_min_match: 10
    scangrid_x_offset: 4
    scangrid_y_offset: 2

  green_off:
    visualize: true
    reference_color:   [
                        0x20, 0x35, 0x0,
                        0x1a, 0x55, 0x0,
                        0x0a, 0x1b, 0,
                        0,    0x16, 2]
    chroma_thresh:     [15, 15, 15, 25]
    saturation_thresh: [15, 20, 7, 8]
    luma_thresh:       [200, 200, 180, 190]
    min_points: 40
    basic_roi_size: 10
    neighborhood_min_match: 9
    scangrid_x_offset: 2
    scangrid_y_offset: 2


  black:
    u_reference: 126
    v_reference: 128
    y_threshold: 20
    u_threshold: 15
    v_threshold: 15
    min_points: 10
    neighborhood_min_match: 5

  bright_light:
    min_brightness: 140
    min_points: 9
    neighborhood_min_match: 2
    min_area_cover: 0.1

  lasercluster:
    enable: false
    min_visibility_history: 10
  
  laser-lines:
    enable: true
    min_visibility_history: 8
    moving_avg: true
