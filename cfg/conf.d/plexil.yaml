%YAML 1.2
%TAG ! tag:fawkesrobotics.org,cfg/
---
doc-url: !url http://trac.fawkesrobotics.org/wiki/Plugins/plexil
---
plexil:

  spec: rcll2016

  rcll2016:
    debug:
      print-xml: true

      enable: true
      markers:
        #- :Node:transition
        #- :Node:outcome
        #- :Node:clock
        #- :Node:deactivatePair
        #- :Node:activatePair
        #- :Node:times
        #- :Node:getDestState
        #- :Node:createCommand
        #- :Node:findVariable
        #- :Node:createDeclaredVars
        #- :Node:getVarsFromInterface
        #- :Node

        #- :AdapterFactory
        #- :DynamicLoader
        #- :ExecApplication
        #- :ExecListenerFactory
        #- :ExecListenerFilterFactory
        #- :InterfaceManager
        #- :InterfaceAdapter
        #- :LuvListener
        #- :UdpAdapter
        - :ProtobufCommAdapter

        #- :ExpressionFactory:registerFactory
        #- :Expression
        #- :IdTable
        #- :ConstRealVariable
        #- :RealVariable
        #- :BinaryExpression
        #- :Test
        #- :StateCache
        #- :InternalCondition

        #- :PlexilExec
        #- :PlexilExec:planVerbose
        #- :PlexilExec:step
        #- :PlexilExec:printPlan
        #- :PlexilExec:cycle
        #- :PlexilExec:handleConditionsChanged
        #- :PlexilExec:addToResourceContention


    # Adpater configuration
    # This part is converted into the Plexil XML interface configuration file.
    # It is a list of mapping nodes, each describing a single adapter.
    # Adapter configuration example:
    # - type: FooAdapter
    #   attr:
    #     HostName: localhost
    #     Port: 3456
    #   args:
    #     name: bar
    #   verbatim-args:
    #     - tag: DefaultCommandAdapter
    #     - tag: CustomTag
    #       text: "some text to put in tag"
    #       attr:
    #         name: bar
    #
    # Explanation:
    # type:
    #   Each adapter must have a type, by which it is loaded.
    # attr:
    #   Enables to add XML attributes into the Adapter tag.
    #   The example shows some viewer parameters for hostname and port.
    # args:
    #   Allow passing of parameters to the adapter. Will be added as <Parameter>
    #   elements with an attribute key referencing the key and the value set as
    #   the tags text.
    # verbatim-args:
    #   Enables directly adding XML tags through the YAML configuration.
    #   It is a list of mappings, each mapping having the following entries.
    #   - tag (required): the XML tag name
    #   - text (optional): added to the text section of the tag
    #   - attr: attributes added to the XML tag.
    # verbatim-xml:
    #   Partial XML document which will be inserted as children in the adapter tag.
    adapters:
      # Do not use Utility, use FawkesLogging instead!
      # Do not use OSNativeTime, use FawkesTime instead!
      - type: ThreadName
        attr:
          name: PlexilExecutive
      - type: FawkesTimeAdapter
      - type: FawkesLoggingAdapter
      - type: FawkesConfigurationAdapter
      - type: BehaviorEngineAdapter
      - type: ProtobufCommAdapter
        attr:
          protos: "@BASEDIR@/src/agents/plexil2016/msgs"
      - type: GlobalState
      - type: NavGraphAdapter

    # A Listener is an object that reports on node state transitions
    # in the plan, and other execution events.
    # cf. http://plexil.sourceforge.net/wiki/index.php/Interface_Configuration_File
    # The configuration supports the same structure as above for adapters.
    # Cf. there for possible values. Some examples are given below.
    listeners:
      # This enables using the Plexil viewer
      - type: LuvListener
        attr:
          Port: 49100
          HostName: 127.0.0.1
          Blocking: false
    #   # The PlanDebugListener outputs as "Node:clock", make sure to enable it in Debug.cfg
    #   - type: PlanDebugListener

    # The Behavior Engine adapter provides a generic skill_call, which can
    # always be declared as skill_call(...) and which takes the skill name
    # as the first parameter, and after that an even number of key/value pairs
    # for the named arguments of the skill.
    #
    # However, it may be desirable to have more descriptive names. This is
    # possible with the following configuration. Then, the adapter will register
    # itself for commands with each of the given names and perform the appropriate
    # mapping.
    skills:
      # Allows for a declaration as say(String text)
      # Note that the order of the arguments is important and must match the order
      # of the arguments in the Plexil declaration!
      - name: say
        args:
          - type: String
            name: text
        template: say{text=?(text)s, wait=true}

      - name: goto
        args:
          - type: String
            name: place
        template: ppgoto{place=?(place)s}
      - name: pick_from_conveyor
        args:
          - type: String
            name: mps
          - type: String
            name: side
        template: get_product_from{place=?(mps)s, side=?(side)s}
      - name: pick_from_shelf
        args:
          - type: String
            name: mps
          - type: String
            name: shelf
        template: get_product_from{place=?(mps)s, side="input", shelf=?(shelf)S}
      - name: put_on_conveyor
        args:
          - type: String
            name: mps
          - type: String
            name: side
        template: bring_product_to{place=?(mps)s, side=?(side)s}
      - name: put_on_shelf
        args:
          - type: String
            name: mps
          - type: String
            name: shelf
        template: bring_product_to{place=?(mps)s, shelf=?(shelf)S}
      - name: put_on_slide
        args:
          - type: String
            name: mps
        template: bring_product_to{place=?(mps)s, slide=true}

    plan:
      # If configured and non-empty, the basedir is prepended to all PLE and PLX
      basedir: "@BASEDIR@/src/agents/plexil2016"

      # List all PLE files which we should consider for compilation.
      ple:
        - plan.ple
        - network_handler.ple
        - SendPrepareBS.ple
        - SendPrepareCS.ple

      # PLX to execute.
      plx: plan.plx

      # Extra lib path to search for (Plexil) libraries
      #lib-path: ["@BASEDIR@/src/agents/plexil2016"]

      compilation:
        # Enable automatic compilation on startup?
        # If enabled, triggers compilation of PLX missing or older than PLE.
        enable: true
        # Force a fresh compile on every startup (compilation must be enabled above)
        force: false

    global-states:
      - name: private_peer_id
        type: Integer
      - name: team_name
        type: String
      - name: team_color
        type: String
      - name: game_phase
        type: String
      - name: game_state
        type: String

    params:
      team-name: Carologistics

      crypto-key: randomkey
      cipher: aes-128-cbc

      robot-name: R-1
      robot-number: 1

      peer-address: 127.0.0.1
      peer-port: 0
      cyan-port: 0
      magenta-port: 0
      peer-recv-port: 4411
      peer-send-port: 4421
      cyan-recv-port: 4451
      magenta-recv-port: 4461
      cyan-send-port: 4471
      magenta-send-port: 4481
