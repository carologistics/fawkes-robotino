%YAML 1.2
%TAG ! tag:fawkesrobotics.org,cfg/
---
doc-url: !url http://trac.fawkesrobotics.org/wiki/Plugins/machine_signal
---

plugins/machine_signal:
  camera: v4l2:front:device=/dev/light_front:size=640x480:awb=0:contrast=33:saturation=30:gain=70:white_balance_temperature=4000:exposure_auto_priority=0:exposure_auto=1:exposure_absolute=600:sharpness=0
  
  #
  # Start running when the plugin is loaded.
  # If set to false, signal detection needs to be activated via the light_switch
  #
  start_enabled: true

  #
  # Which delivery mode to use initially.
  # auto: Try to auto-detect by the width of the largest green ROI
  # on: Assume we're looking at the delivery gates.
  # off: Assume we're looking at the playing field
  # After switching delivery mode on or off with the switch interface
  # "machine_signal_delivery_mode", this config value has no effect anymore.
  #
  delivery_mode: "auto"

  fps: 30

  ###########################################################
  #    All settings below can be changed at runtime         #
  ###########################################################

  # Enable the tuning buffer. Use fvviever -s machine_signal to view.
  #
  #    ------=====:::  ATTENTION  :::=====-----
  # Turn this off during matches to double performance!
  #
  tuning_mode: true

  # Draw ROIs as they are after being filtered, tarred and feathered
  # Disable this to see the raw ROIs as they come out of the classifier
  # (Useful for tuning the colormodels).
  # Ignored if tuning_mode == false.
  draw_processed_rois: true
 
  # Maximum width ratio between red and green ROIs. A red and a green
  # ROI that exceed this are not considered as part of a signal.
  roi_max_r2g_width_ratio: 1.2

  roi_xalign_by_width: 1.0

  # ROIs that exceed this aspect ratio are ignored.
  roi_max_aspect_ratio: 2.5

  # Green ROIs that start above this line are ignored
  roi_green_horizon: 160

  # Maximum distance in pixels a signal is allowed to jump between frames
  # Increase this if you want to try and detect signals while moving.
  max_jitter: 20.0

  red:
    reference_color: [0xff, 0, 0x20]
    chroma_thresh: 20
    saturation_thresh: 20
    min_points: 40
    basic_roi_size: 10
    neighborhood_min_match: 11
    scangrid_x_offset: 2
    scangrid_y_offset: 2

  red_delivery:
    reference_color: [0xff, 0, 0x20]
    chroma_thresh: 8
    saturation_thresh: 50
    min_points: 40
    basic_roi_size: 10
    neighborhood_min_match: 10
    scangrid_x_offset: 2
    scangrid_y_offset: 2

  green:
    reference_color: [0x30, 0xff, 0x20]
    chroma_thresh: 6
    saturation_thresh: 10
    min_points: 50
    basic_roi_size: 10
    neighborhood_min_match: 6
    scangrid_x_offset: 2
    scangrid_y_offset: 2

  black:
    max_luminance: 25
    min_points: 10
    neighborhood_min_match: 5

  bright_light:
    min_brightness: 170
    min_points: 20
    neighborhood_min_match: 2
    min_area_cover: 0.1


